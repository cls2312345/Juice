<script>
    const SECRET_CODE = "DMSADMIN";
    // Your Public Bucket URL (The XML endpoint is usually the base URL)
    const BUCKET_URL = "https://pub-e7c0cf4469274deb8a0ac4b35144263b.r2.dev/";
    
    let rawFiles = []; // This starts empty and fills automatically
    let filteredFiles = [];
    let currentIndex = 0;
    const player = document.getElementById('audioPlayer');
    const titleDisplay = document.getElementById('currentTitle');

    // 1. AUTO-CHECK STORAGE FUNCTION
    async function syncVault() {
        try {
            const response = await fetch(BUCKET_URL);
            const text = await response.text();
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, "text/xml");
            
            // Scans the XML response for <Key> tags (filenames)
            const keys = xml.getElementsByTagName("Key");
            rawFiles = [];
            
            for (let i = 0; i < keys.length; i++) {
                let filename = keys[i].textContent;
                if (filename.endsWith(".mp3")) {
                    rawFiles.push(filename);
                }
            }
            
            filteredFiles = [...rawFiles];
            loadList(filteredFiles);
            console.log("Vault Synced: " + rawFiles.length + " songs found.");
        } catch (err) {
            console.error("Sync failed. Check CORS settings.", err);
            titleDisplay.innerText = "SYNC ERROR - CHECK CORS";
        }
    }

    // Password Access
    document.getElementById('passInput').onkeyup = (e) => {
        if (e.target.value.toUpperCase() === SECRET_CODE) {
            document.getElementById('gatekeeper').style.display = 'none';
            document.getElementById('mainApp').style.display = 'flex';
            syncVault(); // Runs the auto-check as soon as you log in
        }
    };

    function loadList(files) {
        document.getElementById('list').innerHTML = files.map((file, index) => `
            <div class="song-item" id="song-${index}" onclick="playSong(${index})">
                ${file.replace('.mp3', '').replaceAll('%20', ' ')}
            </div>
        `).join('');
    }

    // ... (Keep your existing playSong, toggleShuffle, and handleEnded functions) ...
</script>
